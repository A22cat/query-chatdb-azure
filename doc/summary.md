## テーマ：生成AIを活用したデータベースとのチャットシステムの構築

---

## 1. ソリューション概要

-ソリューション名：QueryChatDbAzure(対話型DBクエリ支援システム)
-プロダクト名：Qnect(キュネクト)

Azureクラウド技術と生成AIを活用し、自然言語でのデータベース操作を可能にするチャットシステムです。このシステムの最大の特長は、ITスキルがなくても誰でもビジネスデータにアクセスでき、迅速な意思決定や業務改善を実現できる点です。ユーザーが自然言語で質問すると、Azure OpenAIがその内容を解析し、適切なSQL文を自動生成してAzure SQL Databaseから業務データを取得し、その結果を分かりやすく説明します。これにより、専門知識がなくても直感的にデータ活用が可能となります。

---

## 2. 解決したい課題

企業内の業務データベースは情報が豊富である一方、専門的な知識がないと活用が難しく、日常業務での意思決定や問い合わせ対応に活かしきれていません。これにより、必要な情報にすぐにアクセスできない、IT部門への依頼が発生するといった問題がうまれます。

企業内の業務データベースは膨大な情報を有していますが、専門知識がない現場担当者にとっては、その情報を十分に引き出して活用することが困難です。その結果、必要なデータを迅速に取得できない、日常的な意思決定や問い合わせ対応のたびにIT部門へ依頼が発生するなど、業務のタイムロスが生じています。こうした状況を改善し、誰もが簡単に業務データへアクセスできる環境の実現が求められています。

---

## 3. 主な機能

- 自然言語からのクエリ生成・実行(SQL自動生成)
- クエリ結果の要約・分析
- データアクセス・変更を防ぐためのセキュリティ機能
- 会話レスポンス内の機密情報のマスキング
- 対話履歴を基にした文脈保持
- ユーザーによるクエリ修正指示への柔軟な対応
- DBからDBスキーマ(テーブル構造)を取得してAzure OpenAIに提示可能
- 埋込用ベクトル生成＋類似検索(Azure OpenAI Embedding + Azure AI Search ベクトルインデックス)
- キーワード検索(完全一致)(Azure Cosmos DB)

---

## 4. 使用技術(Tech Stack)
- Azure OpenAI (Chat用モデル)[gpt-4o または gpt-4o mini]
- Azure SQL Database
- Python
- Streamlit (UI)
- Azure OpenAI (Embedding用モデル)[text-embedding-ada-002 または text-embedding-3-small]
- Azure AI Search
- Azure Cosmos DB
- Azure App Service

---

## 5. スケーラビリティ設計
- Azure OpenAIへの送信Token数と受信Token数を制御し、大規模DBに対応(機能搭載)
- Azure SQL DatabaseからDBスキーマ情報を取得
- 大規模データ処理やグローバル分散対応のため、Azure Cosmos DB導入
- Azure OpenAIはマルチユーザー同時リクエスト対応

**今後のスケーラビリティ向上策**
- テーブル数の増加や構成の複雑化に対応し、DBスキーマ情報を効率的に伝達できるようにするため、LangChainを活用して事前に必要なテーブルのスキーマ情報を判別します。その上で、多くのテーブル情報をOpenAIに渡し、高精度なSQLを生成できるようする。
- ユーザーごとのアクセス権限設定
- テーブル構造のキャッシュ保存と更新頻度制御
- チャット履歴のストレージ保存と分析機能

---

## 6. システム構成

architecture_diagram_Qnect.pdf

---

## 7. 想定されるユースケースと効果

| ユースケース                 | 効果                                                              |
|-----------------------------|-------------------------------------------------------------------|
| 営業担当者の在庫確認         | 数秒でチャット経由で販売データや在庫確認。時間短縮と顧客対応力向上。 |
| 商品データの傾向分析         | ノーコードで売れ筋商品を把握。マーケティングに活用可能。            |
| 経営者の意思決定支援         | 複数DBを横断した要約情報を瞬時に提供。分析時間の削減。              |

---

## 8. 拡張構想

- DBスキーマの詳細な情報を活用し、Token数を最適化する。
- パフォーマンスの高いクエリを生成するため、取り扱うデータ範囲を制限する。
- 会話の流れの中で、適切にコンテキストとメモリを引き渡す。
- SQLAlchemyなどのORMを利用し、テーブルメタデータに基づくルールベースのバリデーションを実施する

---

## 9. GitHubリポジトリのURL

- メインリポジトリ：
https://github.com/A22cat

- 本課題実装のリポジトリ：
https://github.com/A22cat/query-chatdb-azure
